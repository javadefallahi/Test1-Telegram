<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>سقوط – هزارتوی پول</title>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Vazirmatn',sans-serif;background:linear-gradient(120deg,#fdfcfb 0%,#e2d1c3 100%);display:flex;justify-content:center;align-items:flex-start;padding:40px 10px;color:#222}
    #game{width:100%;max-width:640px;background:#fff;border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.08);padding:32px;animation:fadeIn .6s ease}
    @keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:none}}
    h1{font-size:1.5rem;margin-bottom:24px;text-align:center}
    .scene-text{margin-bottom:24px;line-height:1.8}
    .choice{display:block;width:100%;background:#ffca28;border:none;border-radius:12px;padding:12px 16px;margin-bottom:12px;font-size:1rem;cursor:pointer;transition:background .2s}
    .choice:hover{background:#ffc107}
    .hidden{display:none}
    #start-form{display:flex;flex-direction:column;gap:12px;margin-top:12px}
    #start-form input,#start-form select{padding:10px;border:1px solid #ccc;border-radius:8px;font-family:'Vazirmatn',sans-serif}
    #restart{margin-top:24px;background:#26c6da}
  </style>
</head>
<body>
  <div id="game">
    <h1>سقوط – هزارتوی پول</h1>
    <div id="scene" class="scene-text"></div>
    <div id="choices"></div>
    <button id="restart" class="choice hidden">شروع دوباره</button>
  </div>

  <script>
    // ----- player state -----
    const player={age:null,gender:null,impulsivity:0,morality:0,creativity:0,choices:[]};

    // ----- story data (abbreviated for brevity) -----
    const scenes={
      start:{text:`سن و جنسیت خود را وارد کنید و آماده شوید…`,form:true},
      // ... (existing Farsi scenes from previous version go here)
      END_SPARK:{text:`\n✨ پایان: جرقه!\n\nشما از امکانات خود برای ایجاد ارزش استفاده کردید و دیگران را الهام بخشید.`,choices:[]},
      END_MIRROR:{text:`\n🔍 پایان: آینه!\n\nپول را کنار گذاشتید اما خود را عمیق‌تر شناختید.`,choices:[]},
      END_BURN:{text:`\n🔥 پایان: سوختن!\n\nپول رفت ولی درسی ماندگار گرفتید.`,choices:[]},
      END_GHOST:{text:`\n👻 پایان: روح!\n\nتردید باعث شد هیچ کاری نکنید و فرصت از دست رفت.`,choices:[]},
      END_MASK:{text:`\n🎭 پایان: نقاب!\n\nظاهر را نجات دادید اما حقیقت را پنهان کردید.`,choices:[]},
    };

    // ----- engine -----
    const sceneEl=document.getElementById('scene');
    const choicesEl=document.getElementById('choices');
    const restartBtn=document.getElementById('restart');

    function renderScene(id){
      const s=scenes[id];
      sceneEl.textContent='';
      choicesEl.innerHTML='';
      if(s.form){
        sceneEl.innerHTML=s.text;
        const form=document.createElement('form');
        form.id='start-form';
        form.innerHTML=`<input type="number" id="age" placeholder="سن" required min="10" max="100">\n<select id="gender" required><option value="">جنسیت</option><option value="زن">زن</option><option value="مرد">مرد</option><option value="دیگر">دیگر</option></select>\n<button class="choice" type="submit">شروع</button>`;
        sceneEl.appendChild(form);
        form.addEventListener('submit',e=>{e.preventDefault();player.age=form.age.value;player.gender=form.gender.value;renderScene('1');});
        return;
      }
      sceneEl.textContent=s.text;
      if(s.choices){
        s.choices.forEach(ch=>{
          const btn=document.createElement('button');btn.className='choice';btn.textContent=ch.text;btn.onclick=()=>{applyChoice(ch);};choicesEl.appendChild(btn);
        });
      }
      if(id.startsWith('END')){
        restartBtn.classList.remove('hidden');
      }
    }

    function applyChoice(choice){
      // update traits
      Object.keys(choice.effects||{}).forEach(k=>player[k]+=choice.effects[k]);
      player.choices.push(choice.id);
      renderScene(choice.next);
    }

    restartBtn.onclick=()=>{Object.assign(player,{impulsivity:0,morality:0,creativity:0,choices:[]});restartBtn.classList.add('hidden');renderScene('start');};

    // ----- game init -----
    renderScene('start');
  </script>
</body>
</html>
