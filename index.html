<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ø³Ù‚ÙˆØ· â€“ Ù‡Ø²Ø§Ø±ØªÙˆÛŒ Ù¾ÙˆÙ„</title>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Vazirmatn',sans-serif;background:linear-gradient(120deg,#fdfcfb 0%,#e2d1c3 100%);display:flex;justify-content:center;align-items:flex-start;padding:40px 10px;color:#222}
    #game{width:100%;max-width:640px;background:#fff;border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.08);padding:32px;animation:fadeIn .6s ease}
    @keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:none}}
    h1{font-size:1.5rem;margin-bottom:24px;text-align:center}
    .scene-text{margin-bottom:24px;line-height:1.8}
    .choice{display:block;width:100%;background:#ffca28;border:none;border-radius:12px;padding:12px 16px;margin-bottom:12px;font-size:1rem;cursor:pointer;transition:background .2s}
    .choice:hover{background:#ffc107}
    .hidden{display:none}
    #start-form{display:flex;flex-direction:column;gap:12px;margin-top:12px}
    #start-form input,#start-form select{padding:10px;border:1px solid #ccc;border-radius:8px;font-family:'Vazirmatn',sans-serif}
    #restart{margin-top:24px;background:#26c6da}
  </style>
</head>
<body>
  <div id="game">
    <h1>Ø³Ù‚ÙˆØ· â€“ Ù‡Ø²Ø§Ø±ØªÙˆÛŒ Ù¾ÙˆÙ„</h1>
    <div id="scene" class="scene-text"></div>
    <div id="choices"></div>
    <button id="restart" class="choice hidden">Ø´Ø±ÙˆØ¹ Ø¯ÙˆØ¨Ø§Ø±Ù‡</button>
  </div>

  <script>
    // ----- player state -----
    const player={age:null,gender:null,impulsivity:0,morality:0,creativity:0,choices:[]};

    // ----- story data (abbreviated for brevity) -----
    const scenes={
      start:{text:`Ø³Ù† Ùˆ Ø¬Ù†Ø³ÛŒØª Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ Ùˆ Ø¢Ù…Ø§Ø¯Ù‡ Ø´ÙˆÛŒØ¯â€¦`,form:true},
      // ... (existing Farsi scenes from previous version go here)
      END_SPARK:{text:`\nâœ¨ Ù¾Ø§ÛŒØ§Ù†: Ø¬Ø±Ù‚Ù‡!\n\nØ´Ù…Ø§ Ø§Ø² Ø§Ù…Ú©Ø§Ù†Ø§Øª Ø®ÙˆØ¯ Ø¨Ø±Ø§ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ø§Ø±Ø²Ø´ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ø±Ø¯ÛŒØ¯ Ùˆ Ø¯ÛŒÚ¯Ø±Ø§Ù† Ø±Ø§ Ø§Ù„Ù‡Ø§Ù… Ø¨Ø®Ø´ÛŒØ¯.`,choices:[]},
      END_MIRROR:{text:`\nğŸ” Ù¾Ø§ÛŒØ§Ù†: Ø¢ÛŒÙ†Ù‡!\n\nÙ¾ÙˆÙ„ Ø±Ø§ Ú©Ù†Ø§Ø± Ú¯Ø°Ø§Ø´ØªÛŒØ¯ Ø§Ù…Ø§ Ø®ÙˆØ¯ Ø±Ø§ Ø¹Ù…ÛŒÙ‚â€ŒØªØ± Ø´Ù†Ø§Ø®ØªÛŒØ¯.`,choices:[]},
      END_BURN:{text:`\nğŸ”¥ Ù¾Ø§ÛŒØ§Ù†: Ø³ÙˆØ®ØªÙ†!\n\nÙ¾ÙˆÙ„ Ø±ÙØª ÙˆÙ„ÛŒ Ø¯Ø±Ø³ÛŒ Ù…Ø§Ù†Ø¯Ú¯Ø§Ø± Ú¯Ø±ÙØªÛŒØ¯.`,choices:[]},
      END_GHOST:{text:`\nğŸ‘» Ù¾Ø§ÛŒØ§Ù†: Ø±ÙˆØ­!\n\nØªØ±Ø¯ÛŒØ¯ Ø¨Ø§Ø¹Ø« Ø´Ø¯ Ù‡ÛŒÚ† Ú©Ø§Ø±ÛŒ Ù†Ú©Ù†ÛŒØ¯ Ùˆ ÙØ±ØµØª Ø§Ø² Ø¯Ø³Øª Ø±ÙØª.`,choices:[]},
      END_MASK:{text:`\nğŸ­ Ù¾Ø§ÛŒØ§Ù†: Ù†Ù‚Ø§Ø¨!\n\nØ¸Ø§Ù‡Ø± Ø±Ø§ Ù†Ø¬Ø§Øª Ø¯Ø§Ø¯ÛŒØ¯ Ø§Ù…Ø§ Ø­Ù‚ÛŒÙ‚Øª Ø±Ø§ Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯ÛŒØ¯.`,choices:[]},
    };

    // ----- engine -----
    const sceneEl=document.getElementById('scene');
    const choicesEl=document.getElementById('choices');
    const restartBtn=document.getElementById('restart');

    function renderScene(id){
      const s=scenes[id];
      sceneEl.textContent='';
      choicesEl.innerHTML='';
      if(s.form){
        sceneEl.innerHTML=s.text;
        const form=document.createElement('form');
        form.id='start-form';
        form.innerHTML=`<input type="number" id="age" placeholder="Ø³Ù†" required min="10" max="100">\n<select id="gender" required><option value="">Ø¬Ù†Ø³ÛŒØª</option><option value="Ø²Ù†">Ø²Ù†</option><option value="Ù…Ø±Ø¯">Ù…Ø±Ø¯</option><option value="Ø¯ÛŒÚ¯Ø±">Ø¯ÛŒÚ¯Ø±</option></select>\n<button class="choice" type="submit">Ø´Ø±ÙˆØ¹</button>`;
        sceneEl.appendChild(form);
        form.addEventListener('submit',e=>{e.preventDefault();player.age=form.age.value;player.gender=form.gender.value;renderScene('1');});
        return;
      }
      sceneEl.textContent=s.text;
      if(s.choices){
        s.choices.forEach(ch=>{
          const btn=document.createElement('button');btn.className='choice';btn.textContent=ch.text;btn.onclick=()=>{applyChoice(ch);};choicesEl.appendChild(btn);
        });
      }
      if(id.startsWith('END')){
        restartBtn.classList.remove('hidden');
      }
    }

    function applyChoice(choice){
      // update traits
      Object.keys(choice.effects||{}).forEach(k=>player[k]+=choice.effects[k]);
      player.choices.push(choice.id);
      renderScene(choice.next);
    }

    restartBtn.onclick=()=>{Object.assign(player,{impulsivity:0,morality:0,creativity:0,choices:[]});restartBtn.classList.add('hidden');renderScene('start');};

    // ----- game init -----
    renderScene('start');
  </script>
</body>
</html>
